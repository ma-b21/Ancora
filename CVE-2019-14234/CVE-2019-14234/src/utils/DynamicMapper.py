import random
import json
import string
import base64


class DynamicMapper:
    """
    生成随机映射
    """
    def __init__(self, map_file="./map.json"):
        self.map = {}
        self.map_file = map_file
        self.printable = string.printable[:-6]
    
    def _safe_obfuscate(self, c):
        if c not in self.printable:
            return c
        # 固定 random 种子
        random.seed(42)
        shift = random.randint(1, 10)
        index = self.printable.index(c)
        new_index = (index + shift) % len(self.printable)
        return self.printable[new_index]

    def encode(self, message):
        if message in self.map:
            return self.map[message]
        else:
            encoded = message
            # encoded = ''.join(self._safe_obfuscate(c) for c in message)
            # encoded = base64.b64encode(message.encode()).decode()
            # self.map[message] = encoded
            # with open(self.map_file, 'w') as f:
            #     json.dump(self.map, f, indent=2)
            return encoded
